{% extends 'pageLayouts.html' %}
{% block title %}
Sales
{% endblock %}
{% block content %}
<div class="container">
  <div class="row justify-content-end mb-3">
    <div class="col-md-4 position-relative">
      <form method="get">
        <div class="input-group">
          <input type="search" class="form-control form-control-lg" placeholder="Search" name="search" id="search-input">
          <div class="input-group-append">
            <button type="submit" class="btn btn-lg btn-default">
              <i class="fa fa-search"></i>
            </button>
          </div>
        </div>
        <ul id="suggestions" class="list-group position-absolute" style="top: 100%; z-index: 1000; width: 100%;"></ul>
      </form>
    </div>
  </div>
  <table class="table table-bordered table-hover">
    <thead>
      <tr>
        <th>id</th>
        <th>Photo</th>
        <th>Brand</th>
        <th>Model Name</th>
        <th>MRP</th>
        <th>Edit</th>
        <th>Remove</th>
      </tr>
    </thead>
    <tbody>
      {% for stock in stocks %}
      <tr data-widget="expandable-table" aria-expanded="false" class="{% if stock.isAvailable %}{% else %}bg-secondary{% endif %}">
        <td>{{ stock.id }}</td>
        <td>
          <img src="{{ stock.photo.url }}" alt="" height="110" width="155">
          {% if not stock.isAvailable %}[OUT OF STOCK]{% endif %}
        </td>
        <td>{{ stock.brand }}</td>
        <td><a href="{% url 'saleDetail' stock.id %}">{{ stock.model_name }}</a></td>
        <td>{{ stock.MRP }}</td>
        <td>
          <a href="{% url 'editSales' stock.id %}"><i class="fas fa-edit"></i></a>
        </td>
        <td>
          <a href="{% url 'deleteSales' stock.id %}"><i class="fas fa-trash-alt"></i></a>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('search-input');
    const suggestionsList = document.getElementById('suggestions');
    
    searchInput.addEventListener('input', function() {
      const query = searchInput.value;
      
      if (query) {  // Start showing suggestions after 3 characters
        fetch(`/sales/search-suggestions/?term=${query}`)
          .then(response => response.json())
          .then(data => {
            suggestionsList.innerHTML = '';
            data.forEach(item => {
              const listItem = document.createElement('li');
              listItem.className = 'list-group-item list-group-item-action';
              listItem.textContent = item.label;
              listItem.addEventListener('click', function() {
                searchInput.value = item.model;
                suggestionsList.innerHTML = '';
              });
              suggestionsList.appendChild(listItem);
            });
          });
      } else {
        suggestionsList.innerHTML = '';
      }
    });

    document.addEventListener('click', function(event) {
      if (!searchInput.contains(event.target)) {
        suggestionsList.innerHTML = '';
      }
    });
  });
</script>
{% endblock %}
